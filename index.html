<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D GLB Model Viewer with AR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .btn-ar {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
        }

        .btn-ar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.6);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .viewer-container {
            flex: 1;
            position: relative;
            margin: 20px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        #viewer3d {
            width: 100%;
            height: 70vh;
            min-height: 400px;
            display: block;
            border-radius: 20px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            color: #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 10px;
                gap: 10px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            #viewer3d {
                height: 60vh;
                min-height: 300px;
            }
            
            .viewer-container {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ 3D Model Viewer</h1>
            <p>View your 3D model in stunning detail and AR</p>
        </div>

        <div class="controls">
            <button id="loadModel" class="btn btn-primary">üì¶ Load 3D Model</button>
            <button id="enterAR" class="btn btn-ar" disabled>ü•Ω Enter AR Mode</button>
            <button id="resetView" class="btn btn-primary">üîÑ Reset View</button>
        </div>

        <div class="viewer-container">
            <canvas id="viewer3d"></canvas>
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading 3D Model...</p>
            </div>
        </div>

        <div class="info">
            üí° <strong>Instructions:</strong> Click "Load 3D Model" to start. Use mouse/touch to rotate, zoom, and pan. 
            For AR mode, ensure you're on a mobile device with camera access.
        </div>
    </div>

    <!-- Three.js and required libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/loaders/GLTFLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/controls/OrbitControls.js"></script>

    <script>
        class GLBViewer {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.model = null;
                this.isARSupported = false;
                this.isModelLoaded = false;
                
                this.init();
                this.setupEventListeners();
                this.checkARSupport();
            }

            init() {
                const canvas = document.getElementById('viewer3d');
                const container = canvas.parentElement;

                // Scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x222222);

                // Camera
                this.camera = new THREE.PerspectiveCamera(
                    75, 
                    container.clientWidth / container.clientHeight, 
                    0.1, 
                    1000
                );
                this.camera.position.set(0, 1, 3);

                // Renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    canvas: canvas, 
                    antialias: true,
                    alpha: true 
                });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                this.renderer.outputEncoding = THREE.sRGBEncoding;
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;

                // Controls
                this.controls = new THREE.OrbitControls(this.camera, canvas);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.screenSpacePanning = false;
                this.controls.minDistance = 1;
                this.controls.maxDistance = 10;

                // Lighting
                this.setupLighting();

                // Handle window resize
                window.addEventListener('resize', () => this.onWindowResize());

                // Start render loop
                this.animate();
            }

            setupLighting() {
                // Ambient light
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);

                // Directional light
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(1, 1, 1);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);

                // Point lights for better illumination
                const pointLight1 = new THREE.PointLight(0xffffff, 0.5, 10);
                pointLight1.position.set(2, 2, 2);
                this.scene.add(pointLight1);

                const pointLight2 = new THREE.PointLight(0xffffff, 0.5, 10);
                pointLight2.position.set(-2, -2, -2);
                this.scene.add(pointLight2);
            }

            setupEventListeners() {
                document.getElementById('loadModel').addEventListener('click', () => this.loadModel());
                document.getElementById('enterAR').addEventListener('click', () => this.enterAR());
                document.getElementById('resetView').addEventListener('click', () => this.resetView());
            }

            async checkARSupport() {
                if ('xr' in navigator) {
                    try {
                        const isSupported = await navigator.xr.isSessionSupported('immersive-ar');
                        this.isARSupported = isSupported;
                        if (!isSupported) {
                            console.log('AR not supported on this device');
                        }
                    } catch (error) {
                        console.log('Error checking AR support:', error);
                        this.isARSupported = false;
                    }
                } else {
                    this.isARSupported = false;
                }
            }

            showLoading(show) {
                const loading = document.getElementById('loading');
                loading.style.display = show ? 'block' : 'none';
            }

            showError(message) {
                const container = document.querySelector('.viewer-container');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.innerHTML = `
                    <h3>‚ùå Error Loading Model</h3>
                    <p>${message}</p>
                    <p><strong>Troubleshooting:</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li>Make sure your GLB file is in the "models/" folder</li>
                        <li>Check that the file is named "model.glb"</li>
                        <li>Ensure the file is a valid GLB format</li>
                        <li>Try refreshing the page</li>
                    </ul>
                `;
                container.appendChild(errorDiv);
            }

            loadModel() {
                this.showLoading(true);
                
                // Remove any existing error messages
                const existingError = document.querySelector('.error');
                if (existingError) {
                    existingError.remove();
                }

                const loader = new THREE.GLTFLoader();
                
                loader.load(
                    'models/model.glb',  // Your GLB file path
                    (gltf) => {
                        this.onModelLoaded(gltf);
                    },
                    (progress) => {
                        console.log('Loading progress:', (progress.loaded / progress.total * 100) + '%');
                    },
                    (error) => {
                        console.error('Error loading model:', error);
                        this.showLoading(false);
                        this.showError('Could not load the 3D model. Please check the file path and format.');
                    }
                );
            }

            onModelLoaded(gltf) {
                this.showLoading(false);
                
                // Remove existing model
                if (this.model) {
                    this.scene.remove(this.model);
                }

                this.model = gltf.scene;
                
                // Center and scale the model
                const box = new THREE.Box3().setFromObject(this.model);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                // Center the model
                this.model.position.sub(center);
                
                // Scale the model to fit nicely in view
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 2 / maxDim;
                this.model.scale.setScalar(scale);

                // Enable shadows if the model supports it
                this.model.traverse((child) => {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                });

                this.scene.add(this.model);
                this.isModelLoaded = true;

                // Enable AR button if AR is supported
                const arButton = document.getElementById('enterAR');
                arButton.disabled = !this.isARSupported;
                
                if (this.isARSupported) {
                    arButton.textContent = 'ü•Ω Enter AR Mode';
                } else {
                    arButton.textContent = '‚ùå AR Not Supported';
                }

                console.log('Model loaded successfully!');
            }

            resetView() {
                if (this.model) {
                    this.camera.position.set(0, 1, 3);
                    this.controls.reset();
                }
            }

            async enterAR() {
                if (!this.isARSupported) {
                    alert('AR is not supported on this device or browser. Please use Chrome on Android with ARCore support.');
                    return;
                }

                if (!this.isModelLoaded) {
                    alert('Please load a 3D model first!');
                    return;
                }

                try {
                    // Request AR session
                    const session = await navigator.xr.requestSession('immersive-ar', {
                        requiredFeatures: ['local', 'hit-test']
                    });

                    // Enable WebXR for the renderer
                    this.renderer.xr.enabled = true;
                    this.renderer.xr.setSession(session);

                    console.log('AR session started!');
                    
                } catch (error) {
                    console.error('Error starting AR:', error);
                    alert('Could not start AR session. Make sure you\'re using a compatible device and browser.');
                }
            }

            onWindowResize() {
                const container = document.querySelector('.viewer-container');
                const canvas = document.getElementById('viewer3d');
                
                this.camera.aspect = container.clientWidth / container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(container.clientWidth, container.clientHeight);
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                
                this.controls.update();
                
                // Rotate model slowly for demo effect if loaded
                if (this.model && !this.controls.autoRotate) {
                    this.model.rotation.y += 0.005;
                }
                
                this.renderer.render(this.scene, this.camera);
            }
        }

        // Initialize the viewer when page loads
        window.addEventListener('DOMContentLoaded', () => {
            new GLBViewer();
        });
    </script>
</body>
</html>
